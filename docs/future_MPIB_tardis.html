<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ruben Arslan" />

<meta name="date" content="2017-10-30" />

<title>try</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("future_MPIB_tardis.Rmd");
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Trying the future package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="future_ARC_Rserver.html">ARC R Server</a>
</li>
<li>
  <a href="future_MPIB_tardis.html">MPIB Tardis</a>
</li>
<li>
  <a href="future_GWDG_SCC.html">GWDG SCC</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rubenarslan/try_future">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">try</h1>
<h4 class="author"><em>Ruben Arslan</em></h4>
<h4 class="date"><em>30 October 2017</em></h4>

</div>


<div id="future-package" class="section level2">
<h2>Future package</h2>
<p>Vignettes in package ‘future’:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># vignette(&quot;future-1-overview&quot;)</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(future)</a></code></pre></div>
</div>
<div id="use-r-directly-on-the-server-no-scheduler" class="section level2">
<h2>Use R directly on the server (no scheduler)</h2>
<p>This approach works for a server that is SSH-accessible and has R and the <strong>future</strong> package installed. To be able to SSH in without storing your password in plaintext somewhere, you’ll need to set up public key authentification. You do this by copying your public key to <code>~/.ssh/authorized_keys</code> on the server. If you’ve already generated a public key on your local machine, it should be in <code>~/.ssh/id_rsa.pub</code> or something similar. If you haven’t yet, Google how :-) You’ll have to do this for every server you want to use.</p>
<p>You can automatically do this using (<a href="https://askubuntu.com/questions/4830/easiest-way-to-copy-ssh-keys-to-another-machine">source</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">ssh-copy-id</span> user@tardis.mpib-berlin.mpg.de</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;future&quot;</span>) <span class="co"># this is the package we use to flexibly scale our processing</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;listenv&quot;</span>) <span class="co"># this is a helper package that allows us to assign the results to a list even if they come in at different times</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">## Set up access to remote login node</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>) <span class="co"># Your username goes before the @</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">plan</span>(login) <span class="co"># this tells the future package that we want to use a remote server for running our future operations</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># but maybe the reason we want to shift to a server is not that we want to run a simple sequential operation there.</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co"># maybe we want to take advantage of parallelisation and run the operation in parallel on multiple cores</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">## Specify future topology</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">## login node -&gt; { cluster nodes } -&gt; { multiple cores }</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">plan</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  login,</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">  multicore,</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  sequential</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">))</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co"># demo(&quot;mandelbrot&quot;, package = &quot;future&quot;, ask = FALSE)</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">## (a) This will be evaluated on the cluster login computer</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">x <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># this operator binds the result of the promise/future to x</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  thost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">  tpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">  y &lt;-<span class="st"> </span><span class="kw">listenv</span>()</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">  <span class="cf">for</span> (task <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">    ## (b) This will be evaluated on a different core</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">    y[[task]] <span class="op">%&lt;-%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">      mhost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">      mpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">      z &lt;-<span class="st"> </span><span class="kw">listenv</span>()</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">      <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">        ## (c) this will be evaluated sequentially on the same core</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        z[[jj]] <span class="op">%&lt;-%</span><span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">task =</span> task,</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">                                <span class="dt">top.host =</span> thost, <span class="dt">top.pid =</span> tpid,</a>
<a class="sourceLine" id="cb3-35" data-line-number="35">                                <span class="dt">mid.host =</span> mhost, <span class="dt">mid.pid =</span> mpid,</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">                                <span class="dt">host =</span> <span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]],</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">                                <span class="dt">pid =</span> <span class="kw">Sys.getpid</span>())</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">      }</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">      <span class="kw">Reduce</span>(rbind, z)</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">    }</a>
<a class="sourceLine" id="cb3-41" data-line-number="41">  }</a>
<a class="sourceLine" id="cb3-42" data-line-number="42">  <span class="kw">Reduce</span>(rbind, y)</a>
<a class="sourceLine" id="cb3-43" data-line-number="43">}</a>
<a class="sourceLine" id="cb3-44" data-line-number="44"></a>
<a class="sourceLine" id="cb3-45" data-line-number="45">x</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["task"],"name":[1],"type":["int"],"align":["right"]},{"label":["top.host"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["top.pid"],"name":[3],"type":["int"],"align":["right"]},{"label":["mid.host"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["mid.pid"],"name":[5],"type":["int"],"align":["right"]},{"label":["host"],"name":[6],"type":["fctr"],"align":["left"]},{"label":["pid"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"master","3":"9087","4":"master","5":"9135","6":"master","7":"9135","_rn_":"1"},{"1":"1","2":"master","3":"9087","4":"master","5":"9135","6":"master","7":"9135","_rn_":"2"},{"1":"2","2":"master","3":"9087","4":"master","5":"9136","6":"master","7":"9136","_rn_":"3"},{"1":"2","2":"master","3":"9087","4":"master","5":"9136","6":"master","7":"9136","_rn_":"4"},{"1":"3","2":"master","3":"9087","4":"master","5":"9139","6":"master","7":"9139","_rn_":"5"},{"1":"3","2":"master","3":"9087","4":"master","5":"9139","6":"master","7":"9139","_rn_":"6"},{"1":"4","2":"master","3":"9087","4":"master","5":"9148","6":"master","7":"9148","_rn_":"7"},{"1":"4","2":"master","3":"9087","4":"master","5":"9148","6":"master","7":"9148","_rn_":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="tardis-cluster" class="section level2">
<h2>TARDIS cluster</h2>
<p>Of course if you want to do something more major on the cluster, you need to use the Torque job scheduler. For this, you need a second package <code>future.batchtools</code>. Further, you need to copy a template file for job scripts to the server.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;future&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;listenv&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;future.batchtools&quot;</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">library</span>(debugme)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">Sys.setenv</span>(<span class="dt">DEBUGME=</span><span class="st">&#39;batchtools&#39;</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">library</span>(batchtools)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">## Set up access to remote login node</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">qsub &lt;-<span class="st"> </span><span class="kw">tweak</span>(batchtools_torque, <span class="dt">template =</span> <span class="st">&#39;torque-lido.tmpl&#39;</span>, </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">            <span class="co"># workers = &quot;export LSF_ENVDIR=/opt/lsf/conf&quot;,</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">                <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">job.name =</span> <span class="st">&#39;test1&#39;</span>,</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">                                <span class="dt">queue =</span> <span class="st">&#39;default&#39;</span>,</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">                                <span class="dt">walltime =</span> <span class="st">&quot;0:1:0&quot;</span>, <span class="co"># 1 minute runtime</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">                                <span class="dt">memory =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">                                <span class="dt">processes =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb4-17" data-line-number="17"></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co"># we take our local template and write it to the server</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="kw">plan</span>(login)</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">tmpl =<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;torque-lido.tmpl&quot;</span>)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="kw">value</span>(<span class="kw">future</span>({   <span class="kw">cat</span>(tmpl, <span class="dt">file =</span> <span class="st">&quot;torque-lido.tmpl&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) }))</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">all.equal</span>(tmpl, <span class="kw">value</span>(<span class="kw">future</span>({   <span class="kw">readLines</span>(<span class="st">&quot;torque-lido.tmpl&quot;</span>) })))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">## Specify future topology</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">## login node -&gt; { cluster nodes } -&gt; { multiple cores }</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw">plan</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  login,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  qsub,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  multicore</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">))</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">x <span class="op">%&lt;-%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  thost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  tpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="co"># transfer my local tmpl file</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  y &lt;-<span class="st"> </span><span class="kw">listenv</span>()</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="cf">for</span> (task <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">    ## (b) This will be evaluated on a compute node on the cluster</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">    y[[task]] <span class="op">%&lt;-%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">      mhost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">      mpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">      z &lt;-<span class="st"> </span><span class="kw">listenv</span>()</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">      <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">        ## (c) These will be evaluated in separate processes on the same compute node</a>
<a class="sourceLine" id="cb8-24" data-line-number="24">        z[[jj]] <span class="op">%&lt;-%</span><span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">task =</span> task,</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">                                <span class="dt">top.host =</span> thost, <span class="dt">top.pid =</span> tpid,</a>
<a class="sourceLine" id="cb8-26" data-line-number="26">                                <span class="dt">mid.host =</span> mhost, <span class="dt">mid.pid =</span> mpid,</a>
<a class="sourceLine" id="cb8-27" data-line-number="27">                                <span class="dt">host =</span> <span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]],</a>
<a class="sourceLine" id="cb8-28" data-line-number="28">                                <span class="dt">pid =</span> <span class="kw">Sys.getpid</span>())</a>
<a class="sourceLine" id="cb8-29" data-line-number="29">      }</a>
<a class="sourceLine" id="cb8-30" data-line-number="30">      <span class="kw">Reduce</span>(rbind, z)</a>
<a class="sourceLine" id="cb8-31" data-line-number="31">    }</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">  }</a>
<a class="sourceLine" id="cb8-33" data-line-number="33">  <span class="kw">Reduce</span>(rbind, y)</a>
<a class="sourceLine" id="cb8-34" data-line-number="34">}</a>
<a class="sourceLine" id="cb8-35" data-line-number="35"></a>
<a class="sourceLine" id="cb8-36" data-line-number="36">x</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["task"],"name":[1],"type":["int"],"align":["right"]},{"label":["top.host"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["top.pid"],"name":[3],"type":["int"],"align":["right"]},{"label":["mid.host"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["mid.pid"],"name":[5],"type":["int"],"align":["right"]},{"label":["host"],"name":[6],"type":["fctr"],"align":["left"]},{"label":["pid"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"master","3":"9222","4":"ood-44","5":"12568","6":"ood-44","7":"12568","_rn_":"1"},{"1":"1","2":"master","3":"9222","4":"ood-44","5":"12568","6":"ood-44","7":"12568","_rn_":"2"},{"1":"2","2":"master","3":"9222","4":"ood-44","5":"12583","6":"ood-44","7":"12583","_rn_":"3"},{"1":"2","2":"master","3":"9222","4":"ood-44","5":"12583","6":"ood-44","7":"12583","_rn_":"4"},{"1":"3","2":"master","3":"9222","4":"ood-44","5":"12599","6":"ood-44","7":"12599","_rn_":"5"},{"1":"3","2":"master","3":"9222","4":"ood-44","5":"12599","6":"ood-44","7":"12599","_rn_":"6"},{"1":"4","2":"master","3":"9222","4":"ood-44","5":"12614","6":"ood-44","7":"12614","_rn_":"7"},{"1":"4","2":"master","3":"9222","4":"ood-44","5":"12614","6":"ood-44","7":"12614","_rn_":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="brms" class="section level2">
<h2>brms</h2>
<p>brms is a Bayesian regression modelling software. Because we often run multiple chains in brms to assess convergence and obtain samples, more quickly, parallelisation is beneficial. brms has internal support for futures. By setting its <code>future</code> argument to true, it will run the chains according to <code>plan</code>. Because running such a model can take a lot of time, it is beneficial to offload it to a remote server or cluster.</p>
</div>
<div id="use-brms-on-tardis" class="section level2">
<h2>use brms on Tardis</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">## Set up access to remote login node</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># login_vpn &lt;- tweak(remote, workers = &quot;rarslan@login.gwdg.de&quot;) # doesn&#39;t work because R not installed</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">qsub &lt;-<span class="st"> </span><span class="kw">tweak</span>(batchtools_torque, <span class="dt">template =</span> <span class="st">&#39;torque-lido.tmpl&#39;</span>, </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">            <span class="co"># workers = &quot;export LSF_ENVDIR=/opt/lsf/conf&quot;,</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">job.name =</span> <span class="st">&#39;test1&#39;</span>,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                                <span class="dt">queue =</span> <span class="st">&#39;default&#39;</span>,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                                <span class="dt">walltime =</span> <span class="st">&quot;1:0:0&quot;</span>, <span class="co"># 1 hour runtime</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                                <span class="dt">memory =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">                                <span class="dt">processes =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">## Specify future topology</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">## login node -&gt; { cluster node (compile brms model) } -&gt; { run chains on multiple cores }</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="kw">plan</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">  login,</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">  qsub,</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">  multicore</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">))</a>
<a class="sourceLine" id="cb9-21" data-line-number="21"></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">mydata =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb9-23" data-line-number="23"></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">model_name &lt;-<span class="st"> &quot;mydata_model.rds&quot;</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25">fit2 <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># retrieve the model if it has been fit already</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26">  <span class="cf">if</span> (<span class="kw">file.exists</span>(model_name))</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">    <span class="kw">readRDS</span>(model_name)</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="cf">if</span> (<span class="kw">is.null</span>(fit2)) {</a>
<a class="sourceLine" id="cb9-30" data-line-number="30">  fit2 <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># login to tardis</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31">    model <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># qsub</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32">      <span class="kw">message</span>(model_name)</a>
<a class="sourceLine" id="cb9-33" data-line-number="33">      <span class="kw">brm</span>(x <span class="op">~</span><span class="st"> </span>y, </a>
<a class="sourceLine" id="cb9-34" data-line-number="34">        <span class="dt">data =</span> mydata, </a>
<a class="sourceLine" id="cb9-35" data-line-number="35">        <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb9-36" data-line-number="36">        <span class="dt">future =</span> <span class="ot">TRUE</span> <span class="co">#multicore</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37">        )</a>
<a class="sourceLine" id="cb9-38" data-line-number="38">    }</a>
<a class="sourceLine" id="cb9-39" data-line-number="39">    <span class="kw">saveRDS</span>(model, <span class="dt">file =</span> model_name) <span class="co"># in case we lose the connection, save the result</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40">    model</a>
<a class="sourceLine" id="cb9-41" data-line-number="41">  }</a>
<a class="sourceLine" id="cb9-42" data-line-number="42">}</a>
<a class="sourceLine" id="cb9-43" data-line-number="43"></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co"># but the program will wait for it</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45">fit2</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: x ~ y 
##    Data: mydata (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1; 
##          total post-warmup samples = 4000
##     ICs: LOO = NA; WAIC = NA; R2 = NA
##  
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.01      0.11    -0.22     0.21       4000 1.00
## y            -0.07      0.10    -0.27     0.13       3842 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.04      0.08     0.91     1.19       3633 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># don&#39;t make your plots on the cluster, make em at home</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">marginal_effects</span>(fit2)</a></code></pre></div>
<p><img src="future_MPIB_tardis_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>You can track progress for your job here: <a href="https://tardis.mpib-berlin.mpg.de/jobs/" class="uri">https://tardis.mpib-berlin.mpg.de/jobs/</a></p>
<p>(find your name, click the job)</p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAidHJ5IgphdXRob3I6ICJSdWJlbiBBcnNsYW4iCmRhdGU6ICIzMCBPY3RvYmVyIDIwMTciCm91dHB1dDogCiAgaHRtbF9kb2N1bWVudDoKICAgIGRmX3ByaW50OiBwYWdlZAotLS0KCmBgYHtyIHNldHVwLCBpbmNsdWRlPUZBTFNFfQprbml0cjo6b3B0c19jaHVuayRzZXQoZWNobyA9IFRSVUUpCmBgYAoKIyMgRnV0dXJlIHBhY2thZ2UKVmlnbmV0dGVzIGluIHBhY2thZ2Ug4oCYZnV0dXJl4oCZOgoKYGBge3IgbG9hZH0KIyB2aWduZXR0ZSgiZnV0dXJlLTEtb3ZlcnZpZXciKQpsaWJyYXJ5KGZ1dHVyZSkKYGBgCgojIyBVc2UgUiBkaXJlY3RseSBvbiB0aGUgc2VydmVyIChubyBzY2hlZHVsZXIpCgpUaGlzIGFwcHJvYWNoIHdvcmtzIGZvciBhIHNlcnZlciB0aGF0IGlzIFNTSC1hY2Nlc3NpYmxlIGFuZCBoYXMgUiBhbmQgdGhlIF9fZnV0dXJlX18gcGFja2FnZSBpbnN0YWxsZWQuIFRvIGJlIGFibGUgdG8gU1NIIGluIHdpdGhvdXQgc3RvcmluZyB5b3VyIHBhc3N3b3JkIGluIHBsYWludGV4dCBzb21ld2hlcmUsIHlvdSdsbCBuZWVkIHRvIHNldCB1cCBwdWJsaWMga2V5IGF1dGhlbnRpZmljYXRpb24uIFlvdSBkbyB0aGlzIGJ5IGNvcHlpbmcgeW91ciBwdWJsaWMga2V5IHRvIGB+Ly5zc2gvYXV0aG9yaXplZF9rZXlzYCBvbiB0aGUgc2VydmVyLiBJZiB5b3UndmUgYWxyZWFkeSBnZW5lcmF0ZWQgYSBwdWJsaWMga2V5IG9uIHlvdXIgbG9jYWwgbWFjaGluZSwgaXQgc2hvdWxkIGJlIGluIGB+Ly5zc2gvaWRfcnNhLnB1YmAgb3Igc29tZXRoaW5nIHNpbWlsYXIuIElmIHlvdSBoYXZlbid0IHlldCwgR29vZ2xlIGhvdyA6LSkKWW91J2xsIGhhdmUgdG8gZG8gdGhpcyBmb3IgZXZlcnkgc2VydmVyIHlvdSB3YW50IHRvIHVzZS4KCllvdSBjYW4gYXV0b21hdGljYWxseSBkbyB0aGlzIHVzaW5nIChbc291cmNlXShodHRwczovL2Fza3VidW50dS5jb20vcXVlc3Rpb25zLzQ4MzAvZWFzaWVzdC13YXktdG8tY29weS1zc2gta2V5cy10by1hbm90aGVyLW1hY2hpbmUpOgoKYGBgYmFzaApzc2gtY29weS1pZCB1c2VyQHRhcmRpcy5tcGliLWJlcmxpbi5tcGcuZGUKYGBgCgoKCmBgYHtyfQpsaWJyYXJ5KCJmdXR1cmUiKSAjIHRoaXMgaXMgdGhlIHBhY2thZ2Ugd2UgdXNlIHRvIGZsZXhpYmx5IHNjYWxlIG91ciBwcm9jZXNzaW5nCmxpYnJhcnkoImxpc3RlbnYiKSAjIHRoaXMgaXMgYSBoZWxwZXIgcGFja2FnZSB0aGF0IGFsbG93cyB1cyB0byBhc3NpZ24gdGhlIHJlc3VsdHMgdG8gYSBsaXN0IGV2ZW4gaWYgdGhleSBjb21lIGluIGF0IGRpZmZlcmVudCB0aW1lcwoKIyMgU2V0IHVwIGFjY2VzcyB0byByZW1vdGUgbG9naW4gbm9kZQpsb2dpbiA8LSB0d2VhayhyZW1vdGUsIHdvcmtlcnMgPSAiYXJzbGFuQHRhcmRpcy5tcGliLWJlcmxpbi5tcGcuZGUiKSAjIFlvdXIgdXNlcm5hbWUgZ29lcyBiZWZvcmUgdGhlIEAKcGxhbihsb2dpbikgIyB0aGlzIHRlbGxzIHRoZSBmdXR1cmUgcGFja2FnZSB0aGF0IHdlIHdhbnQgdG8gdXNlIGEgcmVtb3RlIHNlcnZlciBmb3IgcnVubmluZyBvdXIgZnV0dXJlIG9wZXJhdGlvbnMKCiMgYnV0IG1heWJlIHRoZSByZWFzb24gd2Ugd2FudCB0byBzaGlmdCB0byBhIHNlcnZlciBpcyBub3QgdGhhdCB3ZSB3YW50IHRvIHJ1biBhIHNpbXBsZSBzZXF1ZW50aWFsIG9wZXJhdGlvbiB0aGVyZS4KIyBtYXliZSB3ZSB3YW50IHRvIHRha2UgYWR2YW50YWdlIG9mIHBhcmFsbGVsaXNhdGlvbiBhbmQgcnVuIHRoZSBvcGVyYXRpb24gaW4gcGFyYWxsZWwgb24gbXVsdGlwbGUgY29yZXMKIyMgU3BlY2lmeSBmdXR1cmUgdG9wb2xvZ3kKIyMgbG9naW4gbm9kZSAtPiB7IGNsdXN0ZXIgbm9kZXMgfSAtPiB7IG11bHRpcGxlIGNvcmVzIH0KcGxhbihsaXN0KAogIGxvZ2luLAogIG11bHRpY29yZSwKICBzZXF1ZW50aWFsCikpCiMgZGVtbygibWFuZGVsYnJvdCIsIHBhY2thZ2UgPSAiZnV0dXJlIiwgYXNrID0gRkFMU0UpCgoKIyMgKGEpIFRoaXMgd2lsbCBiZSBldmFsdWF0ZWQgb24gdGhlIGNsdXN0ZXIgbG9naW4gY29tcHV0ZXIKeCAlPC0lIHsgIyB0aGlzIG9wZXJhdG9yIGJpbmRzIHRoZSByZXN1bHQgb2YgdGhlIHByb21pc2UvZnV0dXJlIHRvIHgKICB0aG9zdCA8LSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0KICB0cGlkIDwtIFN5cy5nZXRwaWQoKQogIHkgPC0gbGlzdGVudigpCiAgZm9yICh0YXNrIGluIDE6NCkgewogICAgIyMgKGIpIFRoaXMgd2lsbCBiZSBldmFsdWF0ZWQgb24gYSBkaWZmZXJlbnQgY29yZQogICAgeVtbdGFza11dICU8LSUgewogICAgICBtaG9zdCA8LSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0KICAgICAgbXBpZCA8LSBTeXMuZ2V0cGlkKCkKICAgICAgeiA8LSBsaXN0ZW52KCkKICAgICAgZm9yIChqaiBpbiAxOjIpIHsKICAgICAgICAjIyAoYykgdGhpcyB3aWxsIGJlIGV2YWx1YXRlZCBzZXF1ZW50aWFsbHkgb24gdGhlIHNhbWUgY29yZQogICAgICAgIHpbW2pqXV0gJTwtJSBkYXRhLmZyYW1lKHRhc2sgPSB0YXNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcC5ob3N0ID0gdGhvc3QsIHRvcC5waWQgPSB0cGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pZC5ob3N0ID0gbWhvc3QsIG1pZC5waWQgPSBtcGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3QgPSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkID0gU3lzLmdldHBpZCgpKQogICAgICB9CiAgICAgIFJlZHVjZShyYmluZCwgeikKICAgIH0KICB9CiAgUmVkdWNlKHJiaW5kLCB5KQp9Cgp4CmBgYAoKCiMjIFRBUkRJUyBjbHVzdGVyCk9mIGNvdXJzZSBpZiB5b3Ugd2FudCB0byBkbyBzb21ldGhpbmcgbW9yZSBtYWpvciBvbiB0aGUgY2x1c3RlciwgeW91IG5lZWQgdG8gdXNlIHRoZSBUb3JxdWUgam9iIHNjaGVkdWxlci4KRm9yIHRoaXMsIHlvdSBuZWVkIGEgc2Vjb25kIHBhY2thZ2UgYGZ1dHVyZS5iYXRjaHRvb2xzYC4gRnVydGhlciwgeW91IG5lZWQgdG8gY29weSBhIHRlbXBsYXRlIGZpbGUgZm9yIGpvYiBzY3JpcHRzIHRvIHRoZSBzZXJ2ZXIuCgpgYGB7cn0KbGlicmFyeSgiZnV0dXJlIikKbGlicmFyeSgibGlzdGVudiIpCmxpYnJhcnkoImZ1dHVyZS5iYXRjaHRvb2xzIikKbGlicmFyeShkZWJ1Z21lKQpTeXMuc2V0ZW52KERFQlVHTUU9J2JhdGNodG9vbHMnKQpsaWJyYXJ5KGJhdGNodG9vbHMpCgojIyBTZXQgdXAgYWNjZXNzIHRvIHJlbW90ZSBsb2dpbiBub2RlCmxvZ2luIDwtIHR3ZWFrKHJlbW90ZSwgd29ya2VycyA9ICJhcnNsYW5AdGFyZGlzLm1waWItYmVybGluLm1wZy5kZSIpCnFzdWIgPC0gdHdlYWsoYmF0Y2h0b29sc190b3JxdWUsIHRlbXBsYXRlID0gJ3RvcnF1ZS1saWRvLnRtcGwnLCAKICAgICAgICAgICAgIyB3b3JrZXJzID0gImV4cG9ydCBMU0ZfRU5WRElSPS9vcHQvbHNmL2NvbmYiLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzID0gbGlzdChqb2IubmFtZSA9ICd0ZXN0MScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUgPSAnZGVmYXVsdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FsbHRpbWUgPSAiMDoxOjAiLCAjIDEgbWludXRlIHJ1bnRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vcnkgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlcyA9IDQpKQoKCiMgd2UgdGFrZSBvdXIgbG9jYWwgdGVtcGxhdGUgYW5kIHdyaXRlIGl0IHRvIHRoZSBzZXJ2ZXIKcGxhbihsb2dpbikKdG1wbCA9IHJlYWRMaW5lcygidG9ycXVlLWxpZG8udG1wbCIpCnZhbHVlKGZ1dHVyZSh7ICAgY2F0KHRtcGwsIGZpbGUgPSAidG9ycXVlLWxpZG8udG1wbCIsIHNlcCA9ICJcbiIpIH0pKQphbGwuZXF1YWwodG1wbCwgdmFsdWUoZnV0dXJlKHsgICByZWFkTGluZXMoInRvcnF1ZS1saWRvLnRtcGwiKSB9KSkpCgoKIyMgU3BlY2lmeSBmdXR1cmUgdG9wb2xvZ3kKIyMgbG9naW4gbm9kZSAtPiB7IGNsdXN0ZXIgbm9kZXMgfSAtPiB7IG11bHRpcGxlIGNvcmVzIH0KcGxhbihsaXN0KAogIGxvZ2luLAogIHFzdWIsCiAgbXVsdGljb3JlCikpCgoKCnggJTwtJSB7CiAgdGhvc3QgPC0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dCiAgdHBpZCA8LSBTeXMuZ2V0cGlkKCkKICAjIHRyYW5zZmVyIG15IGxvY2FsIHRtcGwgZmlsZQogIHkgPC0gbGlzdGVudigpCiAgZm9yICh0YXNrIGluIDE6NCkgewogICAgIyMgKGIpIFRoaXMgd2lsbCBiZSBldmFsdWF0ZWQgb24gYSBjb21wdXRlIG5vZGUgb24gdGhlIGNsdXN0ZXIKICAgIHlbW3Rhc2tdXSAlPC0lIHsKICAgICAgbWhvc3QgPC0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dCiAgICAgIG1waWQgPC0gU3lzLmdldHBpZCgpCiAgICAgIHogPC0gbGlzdGVudigpCiAgICAgIGZvciAoamogaW4gMToyKSB7CiAgICAgICAgIyMgKGMpIFRoZXNlIHdpbGwgYmUgZXZhbHVhdGVkIGluIHNlcGFyYXRlIHByb2Nlc3NlcyBvbiB0aGUgc2FtZSBjb21wdXRlIG5vZGUKICAgICAgICB6W1tqal1dICU8LSUgZGF0YS5mcmFtZSh0YXNrID0gdGFzaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AuaG9zdCA9IHRob3N0LCB0b3AucGlkID0gdHBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWQuaG9zdCA9IG1ob3N0LCBtaWQucGlkID0gbXBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZCA9IFN5cy5nZXRwaWQoKSkKICAgICAgfQogICAgICBSZWR1Y2UocmJpbmQsIHopCiAgICB9CiAgfQogIFJlZHVjZShyYmluZCwgeSkKfQoKeApgYGAKCiMjIGJybXMKYnJtcyBpcyBhIEJheWVzaWFuIHJlZ3Jlc3Npb24gbW9kZWxsaW5nIHNvZnR3YXJlLiBCZWNhdXNlIHdlIG9mdGVuIHJ1biBtdWx0aXBsZSBjaGFpbnMgaW4gYnJtcyB0byBhc3Nlc3MgY29udmVyZ2VuY2UgYW5kIG9idGFpbiBzYW1wbGVzLCBtb3JlIHF1aWNrbHksIHBhcmFsbGVsaXNhdGlvbiBpcyBiZW5lZmljaWFsLiBicm1zIGhhcyBpbnRlcm5hbCBzdXBwb3J0IGZvciBmdXR1cmVzLiBCeSBzZXR0aW5nIGl0cyBgZnV0dXJlYCBhcmd1bWVudCB0byB0cnVlLCBpdCB3aWxsIHJ1biB0aGUgY2hhaW5zIGFjY29yZGluZyB0byBgcGxhbmAuCkJlY2F1c2UgcnVubmluZyBzdWNoIGEgbW9kZWwgY2FuIHRha2UgYSBsb3Qgb2YgdGltZSwgaXQgaXMgYmVuZWZpY2lhbCB0byBvZmZsb2FkIGl0IHRvIGEgcmVtb3RlIHNlcnZlciBvciBjbHVzdGVyLgoKIyMgdXNlIGJybXMgb24gVGFyZGlzCgpgYGB7cn0KCiMjIFNldCB1cCBhY2Nlc3MgdG8gcmVtb3RlIGxvZ2luIG5vZGUKIyBsb2dpbl92cG4gPC0gdHdlYWsocmVtb3RlLCB3b3JrZXJzID0gInJhcnNsYW5AbG9naW4uZ3dkZy5kZSIpICMgZG9lc24ndCB3b3JrIGJlY2F1c2UgUiBub3QgaW5zdGFsbGVkCmxvZ2luIDwtIHR3ZWFrKHJlbW90ZSwgd29ya2VycyA9ICJhcnNsYW5AdGFyZGlzLm1waWItYmVybGluLm1wZy5kZSIpCnFzdWIgPC0gdHdlYWsoYmF0Y2h0b29sc190b3JxdWUsIHRlbXBsYXRlID0gJ3RvcnF1ZS1saWRvLnRtcGwnLCAKICAgICAgICAgICAgIyB3b3JrZXJzID0gImV4cG9ydCBMU0ZfRU5WRElSPS9vcHQvbHNmL2NvbmYiLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzID0gbGlzdChqb2IubmFtZSA9ICd0ZXN0MScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUgPSAnZGVmYXVsdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FsbHRpbWUgPSAiMTowOjAiLCAjIDEgaG91ciBydW50aW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb3J5ID0gNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZXMgPSA0KSkKCmxpYnJhcnkoYnJtcykKCiMjIFNwZWNpZnkgZnV0dXJlIHRvcG9sb2d5CiMjIGxvZ2luIG5vZGUgLT4geyBjbHVzdGVyIG5vZGUgKGNvbXBpbGUgYnJtcyBtb2RlbCkgfSAtPiB7IHJ1biBjaGFpbnMgb24gbXVsdGlwbGUgY29yZXMgfQpwbGFuKGxpc3QoCiAgbG9naW4sCiAgcXN1YiwKICBtdWx0aWNvcmUKKSkKCm15ZGF0YSA9IGRhdGEuZnJhbWUoeCA9IHJub3JtKDEwMCksIHkgPSBybm9ybSgxMDApKQoKbW9kZWxfbmFtZSA8LSAibXlkYXRhX21vZGVsLnJkcyIKZml0MiAlPC0lIHsgIyByZXRyaWV2ZSB0aGUgbW9kZWwgaWYgaXQgaGFzIGJlZW4gZml0IGFscmVhZHkKICBpZiAoZmlsZS5leGlzdHMobW9kZWxfbmFtZSkpCiAgICByZWFkUkRTKG1vZGVsX25hbWUpCn0KaWYgKGlzLm51bGwoZml0MikpIHsKICBmaXQyICU8LSUgeyAjIGxvZ2luIHRvIHRhcmRpcwogICAgbW9kZWwgJTwtJSB7ICMgcXN1YgogICAgICBtZXNzYWdlKG1vZGVsX25hbWUpCiAgICAgIGJybSh4IH4geSwgCiAgICAgICAgZGF0YSA9IG15ZGF0YSwgCiAgICAgICAgY2hhaW5zID0gNCwKICAgICAgICBmdXR1cmUgPSBUUlVFICNtdWx0aWNvcmUKICAgICAgICApCiAgICB9CiAgICBzYXZlUkRTKG1vZGVsLCBmaWxlID0gbW9kZWxfbmFtZSkgIyBpbiBjYXNlIHdlIGxvc2UgdGhlIGNvbm5lY3Rpb24sIHNhdmUgdGhlIHJlc3VsdAogICAgbW9kZWwKICB9Cn0KCiMgYnV0IHRoZSBwcm9ncmFtIHdpbGwgd2FpdCBmb3IgaXQKZml0MgoKIyBkb24ndCBtYWtlIHlvdXIgcGxvdHMgb24gdGhlIGNsdXN0ZXIsIG1ha2UgZW0gYXQgaG9tZQptYXJnaW5hbF9lZmZlY3RzKGZpdDIpCmBgYAoKCllvdSBjYW4gdHJhY2sgcHJvZ3Jlc3MgZm9yIHlvdXIgam9iIGhlcmU6Cmh0dHBzOi8vdGFyZGlzLm1waWItYmVybGluLm1wZy5kZS9qb2JzLwoKKGZpbmQgeW91ciBuYW1lLCBjbGljayB0aGUgam9iKQo=</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
