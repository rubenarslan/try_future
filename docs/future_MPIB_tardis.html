<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ruben Arslan" />

<meta name="date" content="2017-10-30" />

<title>try</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/FileSaver.min.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; } /* Keyword */
code > span.dt { color: #dfdfbf; } /* DataType */
code > span.dv { color: #dcdccc; } /* DecVal */
code > span.bn { color: #dca3a3; } /* BaseN */
code > span.fl { color: #c0bed1; } /* Float */
code > span.ch { color: #dca3a3; } /* Char */
code > span.st { color: #cc9393; } /* String */
code > span.co { color: #7f9f7f; } /* Comment */
code > span.ot { color: #efef8f; } /* Other */
code > span.al { color: #ffcfaf; } /* Alert */
code > span.fu { color: #efef8f; } /* Function */
code > span.er { color: #c3bf9f; } /* Error */
code > span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
code > span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code > span.sc { color: #dca3a3; } /* SpecialChar */
code > span.vs { color: #cc9393; } /* VerbatimString */
code > span.ss { color: #cc9393; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #f0dfaf; } /* ControlFlow */
code > span.op { color: #f0efd0; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #7f9f7f; } /* Documentation */
code > span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code > span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code > span.in { color: #7f9f7f; font-weight: bold; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("future_MPIB_tardis.Rmd");
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Trying the future package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="future_ARC_Rserver.html">ARC R Server</a>
</li>
<li>
  <a href="future_MPIB_tardis.html">MPIB Tardis</a>
</li>
<li>
  <a href="future_GWDG_SCC.html">GWDG SCC</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rubenarslan/try_future">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">try</h1>
<h4 class="author"><em>Ruben Arslan</em></h4>
<h4 class="date"><em>30 October 2017</em></h4>

</div>


<div id="future-package" class="section level2">
<h2>Future package</h2>
<p>Vignettes in package ‘future’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vignette(&quot;future-1-overview&quot;)</span>
<span class="kw">library</span>(future)</code></pre></div>
</div>
<div id="simple-local" class="section level2">
<h2>Simple, local</h2>
<p>A simple local example. Multiprocess starts whatever multiprocess tool is available on the platform (e.g. Multicore on Unix-based system, PSOCK cluster on Windows).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plan</span>(multiprocess)
v <span class="op">%&lt;-%</span><span class="st"> </span>{
 <span class="kw">cat</span>(<span class="st">&quot;Resolving...</span><span class="ch">\n</span><span class="st">&quot;</span>)
 <span class="fl">3.14</span>
}
v</code></pre></div>
<pre><code>## [1] 3.1</code></pre>
</div>
<div id="use-r-directly-on-the-server-no-scheduler" class="section level2">
<h2>Use R directly on the server (no scheduler)</h2>
<p>This approach works for a server that is SSH-accessible and has R and the <strong>future</strong> package installed. To be able to SSH in without storing your password in plaintext somewhere, you’ll need to set up public key authentification. You do this by copying your public key to <code>~/.ssh/authorized_keys</code> on the server. If you’ve already generated a public key on your local machine, it should be in <code>~/.ssh/id_rsa.pub</code> or something similar. If you haven’t yet, Google how :-) You’ll have to do this for every server you want to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;future&quot;</span>) <span class="co"># this is the package we use to flexibly scale our processing</span>
<span class="kw">library</span>(<span class="st">&quot;listenv&quot;</span>) <span class="co"># this is a helper package that allows us to assign the results to a list even if they come in at different times</span>

## Set up access to remote login node
login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>) <span class="co"># Your username goes before the @</span>
<span class="kw">plan</span>(login) <span class="co"># this tells the future package that we want to use a remote server for running our future operations</span>

<span class="co"># but maybe the reason we want to shift to a server is not that we want to run a simple sequential operation there.</span>
<span class="co"># maybe we want to take advantage of parallelisation and run the operation in parallel on multiple cores</span>
## Specify future topology
## login node -&gt; { cluster nodes } -&gt; { multiple cores }
<span class="kw">plan</span>(<span class="kw">list</span>(
  login,
  multicore,
  sequential
))
<span class="co"># demo(&quot;mandelbrot&quot;, package = &quot;future&quot;, ask = FALSE)</span>


## (a) This will be evaluated on the cluster login computer
x <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># this operator binds the result of the promise/future to x</span>
  thost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]
  tpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()
  y &lt;-<span class="st"> </span><span class="kw">listenv</span>()
  <span class="cf">for</span> (task <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {
    ## (b) This will be evaluated on a different core
    y[[task]] <span class="op">%&lt;-%</span><span class="st"> </span>{
      mhost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]
      mpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()
      z &lt;-<span class="st"> </span><span class="kw">listenv</span>()
      <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {
        ## (c) this will be evaluated sequentially on the same core
        z[[jj]] <span class="op">%&lt;-%</span><span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">task =</span> task,
                                <span class="dt">top.host =</span> thost, <span class="dt">top.pid =</span> tpid,
                                <span class="dt">mid.host =</span> mhost, <span class="dt">mid.pid =</span> mpid,
                                <span class="dt">host =</span> <span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]],
                                <span class="dt">pid =</span> <span class="kw">Sys.getpid</span>())
      }
      <span class="kw">Reduce</span>(rbind, z)
    }
  }
  <span class="kw">Reduce</span>(rbind, y)
}

<span class="kw">print</span>(x)</code></pre></div>
<pre><code>##   task top.host top.pid mid.host mid.pid   host   pid
## 1    1   master   15008   master   15034 master 15034
## 2    1   master   15008   master   15034 master 15034
## 3    2   master   15008   master   15035 master 15035
## 4    2   master   15008   master   15035 master 15035
## 5    3   master   15008   master   15036 master 15036
## 6    3   master   15008   master   15036 master 15036
## 7    4   master   15008   master   15037 master 15037
## 8    4   master   15008   master   15037 master 15037</code></pre>
</div>
<div id="tardis-cluster" class="section level2">
<h2>TARDIS cluster</h2>
<p>Of course if you want to do something more major on the cluster, you need to use the Torque job scheduler. For this, you need a second package <code>future.batchtools</code>. Further, you need to copy a template file for job scripts to the server.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;future&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;listenv&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;future.batchtools&quot;</span>)
<span class="kw">library</span>(debugme)
<span class="kw">Sys.setenv</span>(<span class="dt">DEBUGME=</span><span class="st">&#39;batchtools&#39;</span>)
<span class="kw">library</span>(batchtools)

## Set up access to remote login node
login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>)
qsub &lt;-<span class="st"> </span><span class="kw">tweak</span>(batchtools_torque, <span class="dt">template =</span> <span class="st">&#39;torque-lido.tmpl&#39;</span>, 
            <span class="co"># workers = &quot;export LSF_ENVDIR=/opt/lsf/conf&quot;,</span>
                <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">job.name =</span> <span class="st">&#39;test1&#39;</span>,
                                <span class="dt">log.file =</span> <span class="st">&#39;blaaa2.log&#39;</span>,
                                <span class="dt">queue =</span> <span class="st">&#39;default&#39;</span>,
                                <span class="dt">walltime =</span> <span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>,
                                <span class="dt">memory =</span> <span class="dv">1</span><span class="op">*</span><span class="dv">1024</span>,
                                <span class="dt">processes =</span> <span class="dv">4</span>))

## Specify future topology
## login node -&gt; { cluster nodes } -&gt; { multiple cores }
<span class="kw">plan</span>(<span class="kw">list</span>(
  login,
  qsub,
  multicore
))

tmpl =<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;torque-lido.tmpl&quot;</span>)
x <span class="op">%&lt;-%</span><span class="st"> </span>{
  thost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]
  tpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()
  <span class="co"># transfer my local tmpl file</span>
  <span class="kw">cat</span>(tmpl, <span class="dt">file =</span> <span class="st">&quot;torque-lido.tmpl&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  y &lt;-<span class="st"> </span><span class="kw">listenv</span>()
  <span class="cf">for</span> (task <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {
    ## (b) This will be evaluated on a compute node on the cluster
    y[[task]] <span class="op">%&lt;-%</span><span class="st"> </span>{
      mhost &lt;-<span class="st"> </span><span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]]
      mpid &lt;-<span class="st"> </span><span class="kw">Sys.getpid</span>()
      z &lt;-<span class="st"> </span><span class="kw">listenv</span>()
      <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {
        ## (c) These will be evaluated in separate processes on the same compute node
        z[[jj]] <span class="op">%&lt;-%</span><span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">task =</span> task,
                                <span class="dt">top.host =</span> thost, <span class="dt">top.pid =</span> tpid,
                                <span class="dt">mid.host =</span> mhost, <span class="dt">mid.pid =</span> mpid,
                                <span class="dt">host =</span> <span class="kw">Sys.info</span>()[[<span class="st">&quot;nodename&quot;</span>]],
                                <span class="dt">pid =</span> <span class="kw">Sys.getpid</span>())
      }
      <span class="kw">Reduce</span>(rbind, z)
    }
  }
  <span class="kw">Reduce</span>(rbind, y)
}

<span class="kw">print</span>(x)</code></pre></div>
<pre><code>##   task top.host top.pid mid.host mid.pid  host   pid
## 1    1   master   15075    ood-9   19135 ood-9 19135
## 2    1   master   15075    ood-9   19135 ood-9 19135
## 3    2   master   15075    ood-9   19154 ood-9 19154
## 4    2   master   15075    ood-9   19154 ood-9 19154
## 5    3   master   15075    ood-9   19198 ood-9 19198
## 6    3   master   15075    ood-9   19198 ood-9 19198
## 7    4   master   15075    ood-9   19222 ood-9 19222
## 8    4   master   15075    ood-9   19222 ood-9 19222</code></pre>
</div>
<div id="brms" class="section level2">
<h2>brms</h2>
<p>brms is a Bayesian regression modelling software. Because we often run multiple chains in brms to assess convergence and obtain samples, more quickly, parallelisation is beneficial. brms has internal support for futures. By setting its <code>future</code> argument to true, it will run the chains according to <code>plan</code>. Because running such a model can take a lot of time, it is beneficial to offload it to a remote server or cluster.</p>
</div>
<div id="use-brms-on-tardis" class="section level2">
<h2>use brms on Tardis</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Set up access to remote login node
<span class="co"># login_vpn &lt;- tweak(remote, workers = &quot;rarslan@login.gwdg.de&quot;) # doesn&#39;t work because R not installed</span>
login &lt;-<span class="st"> </span><span class="kw">tweak</span>(remote, <span class="dt">workers =</span> <span class="st">&quot;arslan@tardis.mpib-berlin.mpg.de&quot;</span>)
qsub &lt;-<span class="st"> </span><span class="kw">tweak</span>(batchtools_torque, <span class="dt">template =</span> <span class="st">&#39;torque-lido.tmpl&#39;</span>, 
            <span class="co"># workers = &quot;export LSF_ENVDIR=/opt/lsf/conf&quot;,</span>
                <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">job.name =</span> <span class="st">&#39;test1&#39;</span>,
                                <span class="dt">log.file =</span> <span class="st">&#39;blaaa2.log&#39;</span>,
                                <span class="dt">queue =</span> <span class="st">&#39;default&#39;</span>,
                                <span class="dt">walltime =</span> <span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>,
                                <span class="dt">memory =</span> <span class="dv">10</span><span class="op">*</span><span class="dv">1024</span>,
                                <span class="dt">processes =</span> <span class="dv">4</span>))
<span class="kw">library</span>(brms)

## Specify future topology
## login node -&gt; { cluster node (compile brms model) } -&gt; { run chains on multiple cores }
<span class="kw">plan</span>(<span class="kw">list</span>(
  login,
  qsub,
  multicore
))

fit2 <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># login to tardis</span>
  x <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="co"># bsub</span>
  <span class="kw">library</span>(<span class="st">&quot;brms&quot;</span>)
  <span class="kw">brm</span>(count <span class="op">~</span><span class="st"> </span>log_Age_c <span class="op">+</span><span class="st"> </span>log_Base4_c <span class="op">*</span><span class="st"> </span>Trt <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>patient) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>obs), 
      <span class="dt">data =</span> epilepsy, <span class="dt">family =</span> <span class="kw">poisson</span>(), 
      <span class="dt">chains =</span> <span class="dv">4</span>,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">10</span>), <span class="dt">class =</span> b),
      <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">class =</span> sd)), 
      <span class="dt">future =</span> <span class="ot">TRUE</span> <span class="co">#multicore</span>
      )
    } <span class="op">%globals%</span><span class="st"> </span><span class="ot">FALSE</span>
  x
  }

fit2</code></pre></div>
<pre><code>##  Family: poisson(log) 
## Formula: count ~ log_Age_c + log_Base4_c * Trt + (1 | patient) + (1 | obs) 
##    Data: epilepsy (Number of observations: 236) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1; 
##          total post-warmup samples = 4000
##     ICs: LOO = NA; WAIC = NA; R2 = NA
##  
## Group-Level Effects: 
## ~obs (Number of levels: 236) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)     0.37      0.04     0.29     0.46       1833 1.00
## 
## ~patient (Number of levels: 59) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)     0.51      0.07     0.38     0.66       1785 1.00
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept            1.74      0.11     1.52     1.96       2978 1.00
## log_Age_c            0.48      0.37    -0.27     1.21       2717 1.00
## log_Base4_c          0.88      0.14     0.60     1.16       2177 1.00
## Trt1                -0.34      0.16    -0.64    -0.02       3093 1.00
## log_Base4_c:Trt1     0.35      0.22    -0.08     0.79       2618 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div id="use-brms-with-my-own-data-on-tardis" class="section level3">
<h3>use brms with my own data on Tardis</h3>
<p>Also showing a different way to set up the future and pass along globals and packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Specify future topology
## login node -&gt; { cluster nodes } -&gt; { multiple cores }
<span class="kw">plan</span>(<span class="kw">list</span>(
  login,
  qsub,
  multicore
))

mydata =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>))

fit2 =<span class="st"> </span><span class="kw">future</span>({
  <span class="co"># login to tardis</span>
  <span class="co"># then send off bsub and wait for result</span>
  <span class="kw">value</span>(<span class="kw">future</span>({ <span class="co"># bsub</span>
  <span class="kw">brm</span>(x <span class="op">~</span><span class="st"> </span>y, 
      <span class="dt">data =</span> mydata, 
      <span class="dt">chains =</span> <span class="dv">4</span>,
      <span class="dt">future =</span> <span class="ot">TRUE</span> <span class="co">#multicore</span>
      )
    }, <span class="dt">globals =</span> <span class="kw">c</span>(<span class="st">&quot;mydata&quot;</span>), <span class="dt">packages =</span> <span class="st">&#39;brms&#39;</span>
  ))
})

<span class="kw">resolved</span>(fit2)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># while (!resolved(fit2)) {</span>
<span class="co">#   Sys.sleep(1)</span>
<span class="co"># }</span>
<span class="kw">summary</span>(<span class="kw">value</span>(fit2))</code></pre></div>
<pre><code>##  Family: gaussian(identity) 
## Formula: x ~ y 
##    Data: mydata (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1; 
##          total post-warmup samples = 4000
##     ICs: LOO = NA; WAIC = NA; R2 = NA
##  
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.13      0.11    -0.35     0.09       3425 1.00
## y            -0.00      0.10    -0.20     0.20       3289 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.10      0.08     0.96     1.27       3172 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAidHJ5IgphdXRob3I6ICJSdWJlbiBBcnNsYW4iCmRhdGU6ICIzMCBPY3RvYmVyIDIwMTciCm91dHB1dDogaHRtbF9kb2N1bWVudAotLS0KCmBgYHtyIHNldHVwLCBpbmNsdWRlPUZBTFNFfQprbml0cjo6b3B0c19jaHVuayRzZXQoZWNobyA9IFRSVUUpCmBgYAoKIyMgRnV0dXJlIHBhY2thZ2UKVmlnbmV0dGVzIGluIHBhY2thZ2Ug4oCYZnV0dXJl4oCZOgoKYGBge3IgbG9hZH0KIyB2aWduZXR0ZSgiZnV0dXJlLTEtb3ZlcnZpZXciKQpsaWJyYXJ5KGZ1dHVyZSkKYGBgCgojIyBTaW1wbGUsIGxvY2FsCgpBIHNpbXBsZSBsb2NhbCBleGFtcGxlLiBNdWx0aXByb2Nlc3Mgc3RhcnRzIHdoYXRldmVyIG11bHRpcHJvY2VzcyB0b29sIGlzIGF2YWlsYWJsZSBvbiB0aGUgcGxhdGZvcm0gKGUuZy4gTXVsdGljb3JlIG9uIFVuaXgtYmFzZWQgc3lzdGVtLCBQU09DSyBjbHVzdGVyIG9uIFdpbmRvd3MpLgpgYGB7cn0KcGxhbihtdWx0aXByb2Nlc3MpCnYgJTwtJSB7CiBjYXQoIlJlc29sdmluZy4uLlxuIikKIDMuMTQKfQp2CmBgYAoKIyMgVXNlIFIgZGlyZWN0bHkgb24gdGhlIHNlcnZlciAobm8gc2NoZWR1bGVyKQoKVGhpcyBhcHByb2FjaCB3b3JrcyBmb3IgYSBzZXJ2ZXIgdGhhdCBpcyBTU0gtYWNjZXNzaWJsZSBhbmQgaGFzIFIgYW5kIHRoZSBfX2Z1dHVyZV9fIHBhY2thZ2UgaW5zdGFsbGVkLiBUbyBiZSBhYmxlIHRvIFNTSCBpbiB3aXRob3V0IHN0b3JpbmcgeW91ciBwYXNzd29yZCBpbiBwbGFpbnRleHQgc29tZXdoZXJlLCB5b3UnbGwgbmVlZCB0byBzZXQgdXAgcHVibGljIGtleSBhdXRoZW50aWZpY2F0aW9uLiBZb3UgZG8gdGhpcyBieSBjb3B5aW5nIHlvdXIgcHVibGljIGtleSB0byBgfi8uc3NoL2F1dGhvcml6ZWRfa2V5c2Agb24gdGhlIHNlcnZlci4gSWYgeW91J3ZlIGFscmVhZHkgZ2VuZXJhdGVkIGEgcHVibGljIGtleSBvbiB5b3VyIGxvY2FsIG1hY2hpbmUsIGl0IHNob3VsZCBiZSBpbiBgfi8uc3NoL2lkX3JzYS5wdWJgIG9yIHNvbWV0aGluZyBzaW1pbGFyLiBJZiB5b3UgaGF2ZW4ndCB5ZXQsIEdvb2dsZSBob3cgOi0pCllvdSdsbCBoYXZlIHRvIGRvIHRoaXMgZm9yIGV2ZXJ5IHNlcnZlciB5b3Ugd2FudCB0byB1c2UuCgpgYGB7cn0KbGlicmFyeSgiZnV0dXJlIikgIyB0aGlzIGlzIHRoZSBwYWNrYWdlIHdlIHVzZSB0byBmbGV4aWJseSBzY2FsZSBvdXIgcHJvY2Vzc2luZwpsaWJyYXJ5KCJsaXN0ZW52IikgIyB0aGlzIGlzIGEgaGVscGVyIHBhY2thZ2UgdGhhdCBhbGxvd3MgdXMgdG8gYXNzaWduIHRoZSByZXN1bHRzIHRvIGEgbGlzdCBldmVuIGlmIHRoZXkgY29tZSBpbiBhdCBkaWZmZXJlbnQgdGltZXMKCiMjIFNldCB1cCBhY2Nlc3MgdG8gcmVtb3RlIGxvZ2luIG5vZGUKbG9naW4gPC0gdHdlYWsocmVtb3RlLCB3b3JrZXJzID0gImFyc2xhbkB0YXJkaXMubXBpYi1iZXJsaW4ubXBnLmRlIikgIyBZb3VyIHVzZXJuYW1lIGdvZXMgYmVmb3JlIHRoZSBACnBsYW4obG9naW4pICMgdGhpcyB0ZWxscyB0aGUgZnV0dXJlIHBhY2thZ2UgdGhhdCB3ZSB3YW50IHRvIHVzZSBhIHJlbW90ZSBzZXJ2ZXIgZm9yIHJ1bm5pbmcgb3VyIGZ1dHVyZSBvcGVyYXRpb25zCgojIGJ1dCBtYXliZSB0aGUgcmVhc29uIHdlIHdhbnQgdG8gc2hpZnQgdG8gYSBzZXJ2ZXIgaXMgbm90IHRoYXQgd2Ugd2FudCB0byBydW4gYSBzaW1wbGUgc2VxdWVudGlhbCBvcGVyYXRpb24gdGhlcmUuCiMgbWF5YmUgd2Ugd2FudCB0byB0YWtlIGFkdmFudGFnZSBvZiBwYXJhbGxlbGlzYXRpb24gYW5kIHJ1biB0aGUgb3BlcmF0aW9uIGluIHBhcmFsbGVsIG9uIG11bHRpcGxlIGNvcmVzCiMjIFNwZWNpZnkgZnV0dXJlIHRvcG9sb2d5CiMjIGxvZ2luIG5vZGUgLT4geyBjbHVzdGVyIG5vZGVzIH0gLT4geyBtdWx0aXBsZSBjb3JlcyB9CnBsYW4obGlzdCgKICBsb2dpbiwKICBtdWx0aWNvcmUsCiAgc2VxdWVudGlhbAopKQojIGRlbW8oIm1hbmRlbGJyb3QiLCBwYWNrYWdlID0gImZ1dHVyZSIsIGFzayA9IEZBTFNFKQoKCiMjIChhKSBUaGlzIHdpbGwgYmUgZXZhbHVhdGVkIG9uIHRoZSBjbHVzdGVyIGxvZ2luIGNvbXB1dGVyCnggJTwtJSB7ICMgdGhpcyBvcGVyYXRvciBiaW5kcyB0aGUgcmVzdWx0IG9mIHRoZSBwcm9taXNlL2Z1dHVyZSB0byB4CiAgdGhvc3QgPC0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dCiAgdHBpZCA8LSBTeXMuZ2V0cGlkKCkKICB5IDwtIGxpc3RlbnYoKQogIGZvciAodGFzayBpbiAxOjQpIHsKICAgICMjIChiKSBUaGlzIHdpbGwgYmUgZXZhbHVhdGVkIG9uIGEgZGlmZmVyZW50IGNvcmUKICAgIHlbW3Rhc2tdXSAlPC0lIHsKICAgICAgbWhvc3QgPC0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dCiAgICAgIG1waWQgPC0gU3lzLmdldHBpZCgpCiAgICAgIHogPC0gbGlzdGVudigpCiAgICAgIGZvciAoamogaW4gMToyKSB7CiAgICAgICAgIyMgKGMpIHRoaXMgd2lsbCBiZSBldmFsdWF0ZWQgc2VxdWVudGlhbGx5IG9uIHRoZSBzYW1lIGNvcmUKICAgICAgICB6W1tqal1dICU8LSUgZGF0YS5mcmFtZSh0YXNrID0gdGFzaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AuaG9zdCA9IHRob3N0LCB0b3AucGlkID0gdHBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWQuaG9zdCA9IG1ob3N0LCBtaWQucGlkID0gbXBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gU3lzLmluZm8oKVtbIm5vZGVuYW1lIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZCA9IFN5cy5nZXRwaWQoKSkKICAgICAgfQogICAgICBSZWR1Y2UocmJpbmQsIHopCiAgICB9CiAgfQogIFJlZHVjZShyYmluZCwgeSkKfQoKcHJpbnQoeCkKYGBgCgoKIyMgVEFSRElTIGNsdXN0ZXIKT2YgY291cnNlIGlmIHlvdSB3YW50IHRvIGRvIHNvbWV0aGluZyBtb3JlIG1ham9yIG9uIHRoZSBjbHVzdGVyLCB5b3UgbmVlZCB0byB1c2UgdGhlIFRvcnF1ZSBqb2Igc2NoZWR1bGVyLgpGb3IgdGhpcywgeW91IG5lZWQgYSBzZWNvbmQgcGFja2FnZSBgZnV0dXJlLmJhdGNodG9vbHNgLiBGdXJ0aGVyLCB5b3UgbmVlZCB0byBjb3B5IGEgdGVtcGxhdGUgZmlsZSBmb3Igam9iIHNjcmlwdHMgdG8gdGhlIHNlcnZlci4KCmBgYHtyfQpsaWJyYXJ5KCJmdXR1cmUiKQpsaWJyYXJ5KCJsaXN0ZW52IikKbGlicmFyeSgiZnV0dXJlLmJhdGNodG9vbHMiKQpsaWJyYXJ5KGRlYnVnbWUpClN5cy5zZXRlbnYoREVCVUdNRT0nYmF0Y2h0b29scycpCmxpYnJhcnkoYmF0Y2h0b29scykKCiMjIFNldCB1cCBhY2Nlc3MgdG8gcmVtb3RlIGxvZ2luIG5vZGUKbG9naW4gPC0gdHdlYWsocmVtb3RlLCB3b3JrZXJzID0gImFyc2xhbkB0YXJkaXMubXBpYi1iZXJsaW4ubXBnLmRlIikKcXN1YiA8LSB0d2VhayhiYXRjaHRvb2xzX3RvcnF1ZSwgdGVtcGxhdGUgPSAndG9ycXVlLWxpZG8udG1wbCcsIAogICAgICAgICAgICAjIHdvcmtlcnMgPSAiZXhwb3J0IExTRl9FTlZESVI9L29wdC9sc2YvY29uZiIsCiAgICAgICAgICAgICAgICByZXNvdXJjZXMgPSBsaXN0KGpvYi5uYW1lID0gJ3Rlc3QxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cuZmlsZSA9ICdibGFhYTIubG9nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZSA9ICdkZWZhdWx0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWxsdGltZSA9IDEwICogNjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb3J5ID0gMSoxMDI0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlcyA9IDQpKQoKIyMgU3BlY2lmeSBmdXR1cmUgdG9wb2xvZ3kKIyMgbG9naW4gbm9kZSAtPiB7IGNsdXN0ZXIgbm9kZXMgfSAtPiB7IG11bHRpcGxlIGNvcmVzIH0KcGxhbihsaXN0KAogIGxvZ2luLAogIHFzdWIsCiAgbXVsdGljb3JlCikpCgp0bXBsID0gcmVhZExpbmVzKCJ0b3JxdWUtbGlkby50bXBsIikKeCAlPC0lIHsKICB0aG9zdCA8LSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0KICB0cGlkIDwtIFN5cy5nZXRwaWQoKQogICMgdHJhbnNmZXIgbXkgbG9jYWwgdG1wbCBmaWxlCiAgY2F0KHRtcGwsIGZpbGUgPSAidG9ycXVlLWxpZG8udG1wbCIsIHNlcCA9ICJcbiIpCiAgeSA8LSBsaXN0ZW52KCkKICBmb3IgKHRhc2sgaW4gMTo0KSB7CiAgICAjIyAoYikgVGhpcyB3aWxsIGJlIGV2YWx1YXRlZCBvbiBhIGNvbXB1dGUgbm9kZSBvbiB0aGUgY2x1c3RlcgogICAgeVtbdGFza11dICU8LSUgewogICAgICBtaG9zdCA8LSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0KICAgICAgbXBpZCA8LSBTeXMuZ2V0cGlkKCkKICAgICAgeiA8LSBsaXN0ZW52KCkKICAgICAgZm9yIChqaiBpbiAxOjIpIHsKICAgICAgICAjIyAoYykgVGhlc2Ugd2lsbCBiZSBldmFsdWF0ZWQgaW4gc2VwYXJhdGUgcHJvY2Vzc2VzIG9uIHRoZSBzYW1lIGNvbXB1dGUgbm9kZQogICAgICAgIHpbW2pqXV0gJTwtJSBkYXRhLmZyYW1lKHRhc2sgPSB0YXNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcC5ob3N0ID0gdGhvc3QsIHRvcC5waWQgPSB0cGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pZC5ob3N0ID0gbWhvc3QsIG1pZC5waWQgPSBtcGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3QgPSBTeXMuaW5mbygpW1sibm9kZW5hbWUiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkID0gU3lzLmdldHBpZCgpKQogICAgICB9CiAgICAgIFJlZHVjZShyYmluZCwgeikKICAgIH0KICB9CiAgUmVkdWNlKHJiaW5kLCB5KQp9CgpwcmludCh4KQoKYGBgCgojIyBicm1zCmJybXMgaXMgYSBCYXllc2lhbiByZWdyZXNzaW9uIG1vZGVsbGluZyBzb2Z0d2FyZS4gQmVjYXVzZSB3ZSBvZnRlbiBydW4gbXVsdGlwbGUgY2hhaW5zIGluIGJybXMgdG8gYXNzZXNzIGNvbnZlcmdlbmNlIGFuZCBvYnRhaW4gc2FtcGxlcywgbW9yZSBxdWlja2x5LCBwYXJhbGxlbGlzYXRpb24gaXMgYmVuZWZpY2lhbC4gYnJtcyBoYXMgaW50ZXJuYWwgc3VwcG9ydCBmb3IgZnV0dXJlcy4gQnkgc2V0dGluZyBpdHMgYGZ1dHVyZWAgYXJndW1lbnQgdG8gdHJ1ZSwgaXQgd2lsbCBydW4gdGhlIGNoYWlucyBhY2NvcmRpbmcgdG8gYHBsYW5gLgpCZWNhdXNlIHJ1bm5pbmcgc3VjaCBhIG1vZGVsIGNhbiB0YWtlIGEgbG90IG9mIHRpbWUsIGl0IGlzIGJlbmVmaWNpYWwgdG8gb2ZmbG9hZCBpdCB0byBhIHJlbW90ZSBzZXJ2ZXIgb3IgY2x1c3Rlci4KCiMjIHVzZSBicm1zIG9uIFRhcmRpcwoKYGBge3J9CgojIyBTZXQgdXAgYWNjZXNzIHRvIHJlbW90ZSBsb2dpbiBub2RlCiMgbG9naW5fdnBuIDwtIHR3ZWFrKHJlbW90ZSwgd29ya2VycyA9ICJyYXJzbGFuQGxvZ2luLmd3ZGcuZGUiKSAjIGRvZXNuJ3Qgd29yayBiZWNhdXNlIFIgbm90IGluc3RhbGxlZApsb2dpbiA8LSB0d2VhayhyZW1vdGUsIHdvcmtlcnMgPSAiYXJzbGFuQHRhcmRpcy5tcGliLWJlcmxpbi5tcGcuZGUiKQpxc3ViIDwtIHR3ZWFrKGJhdGNodG9vbHNfdG9ycXVlLCB0ZW1wbGF0ZSA9ICd0b3JxdWUtbGlkby50bXBsJywgCiAgICAgICAgICAgICMgd29ya2VycyA9ICJleHBvcnQgTFNGX0VOVkRJUj0vb3B0L2xzZi9jb25mIiwKICAgICAgICAgICAgICAgIHJlc291cmNlcyA9IGxpc3Qoam9iLm5hbWUgPSAndGVzdDEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5maWxlID0gJ2JsYWFhMi5sb2cnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlID0gJ2RlZmF1bHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhbGx0aW1lID0gMTAgKiA2MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vcnkgPSAxMCoxMDI0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlcyA9IDQpKQpsaWJyYXJ5KGJybXMpCgojIyBTcGVjaWZ5IGZ1dHVyZSB0b3BvbG9neQojIyBsb2dpbiBub2RlIC0+IHsgY2x1c3RlciBub2RlIChjb21waWxlIGJybXMgbW9kZWwpIH0gLT4geyBydW4gY2hhaW5zIG9uIG11bHRpcGxlIGNvcmVzIH0KcGxhbihsaXN0KAogIGxvZ2luLAogIHFzdWIsCiAgbXVsdGljb3JlCikpCgpmaXQyICU8LSUgeyAjIGxvZ2luIHRvIHRhcmRpcwogIHggJTwtJSB7ICMgYnN1YgogIGxpYnJhcnkoImJybXMiKQogIGJybShjb3VudCB+IGxvZ19BZ2VfYyArIGxvZ19CYXNlNF9jICogVHJ0ICsgKDF8cGF0aWVudCkgKyAoMXxvYnMpLCAKICAgICAgZGF0YSA9IGVwaWxlcHN5LCBmYW1pbHkgPSBwb2lzc29uKCksIAogICAgICBjaGFpbnMgPSA0LAogICAgICBwcmlvciA9IGMocHJpb3Ioc3R1ZGVudF90KDUsMCwxMCksIGNsYXNzID0gYiksCiAgICAgIHByaW9yKGNhdWNoeSgwLDIpLCBjbGFzcyA9IHNkKSksIAogICAgICBmdXR1cmUgPSBUUlVFICNtdWx0aWNvcmUKICAgICAgKQogICAgfSAlZ2xvYmFscyUgRkFMU0UKICB4CiAgfQoKZml0MgpgYGAKCiMjIyB1c2UgYnJtcyB3aXRoIG15IG93biBkYXRhIG9uIFRhcmRpcwpBbHNvIHNob3dpbmcgYSBkaWZmZXJlbnQgd2F5IHRvIHNldCB1cCB0aGUgZnV0dXJlIGFuZCBwYXNzIGFsb25nIGdsb2JhbHMgYW5kIHBhY2thZ2VzLgoKYGBge3J9CiMjIFNwZWNpZnkgZnV0dXJlIHRvcG9sb2d5CiMjIGxvZ2luIG5vZGUgLT4geyBjbHVzdGVyIG5vZGVzIH0gLT4geyBtdWx0aXBsZSBjb3JlcyB9CnBsYW4obGlzdCgKICBsb2dpbiwKICBxc3ViLAogIG11bHRpY29yZQopKQoKbXlkYXRhID0gZGF0YS5mcmFtZSh4ID0gcm5vcm0oMTAwKSwgeSA9IHJub3JtKDEwMCkpCgpmaXQyID0gZnV0dXJlKHsKICAjIGxvZ2luIHRvIHRhcmRpcwogICMgdGhlbiBzZW5kIG9mZiBic3ViIGFuZCB3YWl0IGZvciByZXN1bHQKICB2YWx1ZShmdXR1cmUoeyAjIGJzdWIKICBicm0oeCB+IHksIAogICAgICBkYXRhID0gbXlkYXRhLCAKICAgICAgY2hhaW5zID0gNCwKICAgICAgZnV0dXJlID0gVFJVRSAjbXVsdGljb3JlCiAgICAgICkKICAgIH0sIGdsb2JhbHMgPSBjKCJteWRhdGEiKSwgcGFja2FnZXMgPSAnYnJtcycKICApKQp9KQoKcmVzb2x2ZWQoZml0MikKIyB3aGlsZSAoIXJlc29sdmVkKGZpdDIpKSB7CiMgICBTeXMuc2xlZXAoMSkKIyB9CnN1bW1hcnkodmFsdWUoZml0MikpCmBgYAoKCgo=</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
